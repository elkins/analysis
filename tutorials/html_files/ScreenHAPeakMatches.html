<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AnalysisScreen Hit Analysis Peak Matches</title>
    <link rel="stylesheet" href="CcpnVideoTutorials.css">
</head>
<body>
<div class="header"><a href="https://www.ccpn.ac.uk/"><img src="CCPN.png" alt="CCPN Logo" height="50"></a><a
        href="index.html" class="button">Video<br> Tutorials<br> & Manual</a><a href="https://forums.ccpn.ac.uk"><img
        src="CCPNForumLogo.png" alt="CCPN Logo" height="50" style="padding-left: 15px"></a></div>
<br>
<div class="headerBar">AnalysisScreen Hit Analysis Peak Matches</div>
<div class="tutorial">

    <h2>AnalysisScreen Hit Analysis Peak Matches</h2>
    <p><span class="action">Peak Matches</span> are groups of peaks which have been linked (or matched) across your Reference, Control and Target spectra. The matching of peaks can be done either manually or automatically. Peak Matches are the key element of a <a href="ScreenScreeningDataset.html">Screening Dataset</a>.</p>

    <h3>Creating Peak Matches Manually</h3>
    <p>Open the <span class="action">Hit Analysis</span> module by going to the <span class="action">Screen</span> menu and selecting <span class="action">Hit Analysis</span> or using the shortcut <span class="action">HA</span>. In the <span class="action">DataTable</span> drop-down menu select <span class="action">New Item...</span>. Give your dataset a name and select your <span class="action">Reference, Control</span> and <span class="action">Target</span> (optionally also <span class="action">Displacer</span>) <span class="action">SpectrumGroups</span>. Clicking <span class="action">OK</span> will then add a new <span class="action">DataTable</span> to your sidebar and open a new empty screening dataset in the Hit Analysis module. Alternatively, if you already have an existing Screening Dataset, select that from the <span class="action">DataTable</span> drop-down menu.</p>
    <p>You can now start creating Peak Matches which will be added to your screening dataset. This requires the use of the <span class="action">Edit Panel</span> next ot the <span class="action">Peak Binding Scores</span> table. If it isn't already visible, press the <span class="action">Toggle Edit Panel</span> button to make the panel visible. Using one or more SpectrumDisplays, select a set of equivalent peaks in your Reference, Control and Target spectra, click on <span class="action">New/Edit Match</span> in the Hit Analysis module and then <span class="action">OK</span> in the pop-up window. This will add a Peak Match to your dataset which should become visible in your Hit Analysis module tables. You can also select multiple peaks in each spectrum and match them in one go (but make sure you have selected the same number of peaks in each spectrum).</p>

    <h3>Creating Peak Matches Automatically</h3>
    <p>You can automatically create your Peak Matches as part of setting up a screening dataset with the <span class="action">Pipelines</span> module. Open the <span class="action">Pipelines</span> module by going to the <span class="action">Screen</span> menu and selecting <span class="action">Pipelines</span> or using the shortcut <span class="action">PI</span>. Double-click on the <span class="action">Set up Screening dataset</span> pipe in the list of <span class="action">Pipes</span> or drag it into the <span class="action">Drop Pipes</span> area. Give your dataset a <span class="action">Run name</span> and select your <span class="action">Reference, Control</span> and <span class="action">Target</span> (optionally also <span class="action">Displacer</span>) <span class="action">SpectrumGroups</span>. If you are using Reference Singleton spectra rather than Reference Mixtures, either enter your Control Mixtures Spectrum Group as the <span class="action">Origin SpectrumGroup</span>, or leave the <span class="action">Origin SpectrumGroup</span> unspecified and select <span class="action">Use Substance referenceSpectra</span> instead. Now select the <span class="action">Matching Engine</span> of your choice. This is the algorithm used to match the peaks. We would suggest using the <span class="action">Annotation Match</span>. This will simply match and group together those peaks which have the same peak annotation. This is on the basis that our new careful peak copying and snapping algorithm is better at matching peaks than the traditional matching algorithms. If you want to use a traditional algorithm to match the peaks arising from the same compound across the different SpectrumGroups we would recommend using the <span class="action">Nearest Match</span> Engine rather than <span class="action">K-Means</span> or <span class="action">Dynamic Time Warping (DTW)</span>. Finally, select the correct <span class="action">Experiment Type</span> and whether or not to use <span class="action">AutoScale Control-Target Spectra</span>. Run the pipe(line) by pressing the green <span class="action">Play</span> button. Note that this procedure assumes that you have already copied your peaks from your Reference to your Control/Target/Displacer Spectra. For more information about how to do this, see our <a href="https://ccpn.ac.uk/support/tutorials/#screening">Hit Analysis Tutorial</a>.</p>
    <p>As part of the automatic peak matching, a <span class="action">Peak Matching Score</span> is calculated and provided in the <span class="action">Peak Binding Scores</span> table. These scores represent a quality score for how reliable the matching is. The Peak Matching Scores run from 0-5 with 5 representing a highly reliable match and 0 representing an unreliable match. We recommend that you manually inspect and check matches with a Peak Matching Score of 3 or less. If you find any incorrect matches, you can edit/correct them as explained below.</p>

    <h3>Editing Peak Matches</h3>
    <p>Each row in the <span class="action">Peak Binding Scores table</span> represents one Peak Match. When you click on a row in the <span class="action">Peak Binding Scores table</span> the linked SpectrumDisplay will automatically navigate to the peaks which make up this Peak Match. If you decide that this is not in fact a good match, you could delete it by pressing the <span class="action">Delete Match</span> button in the <span class="action">Edit Panel</span> of the Hit Analysis module. Then you could create a new (correct) match in its place.</p>
    <p>Another way to edit a Peak Match is simply to move the peaks / peak symbols from the incorrect locations to the correct signals (you can do this by right-dragging the peak symbols). You can use <span class="action">Snap to Extremum</span> (<span class="action">SE</span>) or <span class="action">Refit Peak</span> (<span class="action">RP</span>) in the normal way. As soon as any peak locations have changed, the scores and other values in the Hit Analysis module tables need to be updated for that match based on the new peak positions. Either this will happen automatically, or the <span class="action">Update button</span> will turn orange, and you need to press it to update the tables with the new values. Whether the table updates automatically or you need to update it manually can be set with the <span class="action">Auto-Update on peak(s) changed</span> option in the <span class="action">Appearance</span> tab of the <span class="action">Settings</span>.</p>
    <p>It is also possible to edit Peak Matches using the <span class="action">New/Edit Match</span> button in the Hit Analysis <span class="action">Edit Panel</span>. If the correct Control peak was matched to your Reference peak, but the wrong Target peak was, you could now select the correct Target peak and then press <span class="action">New/Edit Match</span>. The dialog box will show you the matched peaks on the left and the currently selected peaks on the right. drag the correct Target peak over to the Target peak area on the left and then select <span class="action">Target</span> in the pop-up. Now the incorrect Target peak in the Peak Match has been replaced with the correct one. Again the table will need to update once you have made such an edit to a Peak Match. Whether the table updates automatically or you need to update it manually by pressing the (now orange) <span class="action">Update button</span> depends on whether the <span class="action">Auto-Update on peak(s) changed</span> option in the <span class="action">Appearance</span> tab of the <span class="action">Settings</span> is ticked or not.</p>


</div>
</body>
</html>